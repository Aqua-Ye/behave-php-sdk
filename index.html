<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Behave-php-sdk by othierry</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Behave-php-sdk</h1>
        <p class="header">Behave.io PHP SDK</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/othierry/behave-php-sdk/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/othierry/behave-php-sdk/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/othierry/behave-php-sdk">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/othierry">othierry</a></p>


      </header>
      <section>
        <h3>
<a name="behave-php-sdk" class="anchor" href="#behave-php-sdk"><span class="octicon octicon-link"></span></a>Behave PHP SDK</h3>

<h2>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>Our PHP library lets you easily identify your users, track their behaviours and make full use of the API.
The SDK also allows you to dynamically create and remove leaderboards, contests, badges, retrieve leaderboard results etc...</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting started</h2>

<div class="highlight highlight-php"><pre><span class="k">require_once</span><span class="p">(</span><span class="s2">"behave.php"</span><span class="p">);</span>

<span class="nx">Behave</span><span class="o">::</span><span class="na">init</span><span class="p">(</span><span class="s2">"YOUR_API_SECRET);</span>
</pre></div>

<h2>
<a name="players" class="anchor" href="#players"><span class="octicon octicon-link"></span></a>Players</h2>

<h3>
<a name="identify" class="anchor" href="#identify"><span class="octicon octicon-link"></span></a>Identify</h3>

<p>You need to identify your users at least once so their player profiles can be created.
If you call <code>identify()</code> multiple times with the same user id, the existing player is updated and returned instead. You can optionally attribute some traits to the player.</p>

<div class="highlight highlight-php"><pre><span class="nv">$player</span> <span class="o">=</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">identify</span><span class="p">(</span><span class="s2">"42"</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
  <span class="c1">// traits</span>
  <span class="s1">'email'</span>   <span class="o">=&gt;</span> <span class="s1">'olivier@behave.io'</span><span class="p">,</span>
  <span class="s1">'name'</span>    <span class="o">=&gt;</span> <span class="s1">'Olivier Thierry'</span><span class="p">,</span>
  <span class="s1">'picture'</span> <span class="o">=&gt;</span> <span class="s1">'http://url_to_picture'</span><span class="p">,</span>
  <span class="s1">'foo'</span>     <span class="o">=&gt;</span> <span class="s1">'bar'</span>
<span class="p">));</span>
</pre></div>

<h3>
<a name="other-identities-social" class="anchor" href="#other-identities-social"><span class="octicon octicon-link"></span></a>Other Identities (Social)</h3>

<p>You can add and remove identities from different providers (facebook, twitter, yammer) to your players.
Adding identities from providers allow us to fetch default data (name, picture) ONLY if authorised (we do not ask for additional permissions).</p>

<p>In order to use social features, you need to add provider credentials <a href="http://dashboard.behave.io/settings">to your app settings</a> (e.g: Facebook App Id, etc...)</p>

<p>For example, if you want to add facebook identity to the player 42</p>

<div class="highlight highlight-php"><pre><span class="nx">Behave</span><span class="o">::</span><span class="na">addIdentity</span><span class="p">(</span><span class="s1">'42'</span><span class="p">,</span> <span class="s1">'414214'</span><span class="p">,</span> <span class="s1">'facebook'</span><span class="p">);</span>
</pre></div>

<p>To remove an identity:</p>

<div class="highlight highlight-php"><pre><span class="nx">Behave</span><span class="o">::</span><span class="na">removeIdentity</span><span class="p">(</span><span class="s1">'42'</span><span class="p">,</span> <span class="s1">'facebook'</span><span class="p">);</span>
</pre></div>

<h2>
<a name="behaviours" class="anchor" href="#behaviours"><span class="octicon octicon-link"></span></a>Behaviours</h2>

<p>You need to track your players behaviours if you want to reward them for doing so. Tracking can be either simple or contextual. You can specify ANY key value pairs to describe the context the behaviour was taken. </p>

<h3>
<a name="simple-tracking" class="anchor" href="#simple-tracking"><span class="octicon octicon-link"></span></a>Simple tracking</h3>

<div class="highlight highlight-php"><pre><span class="nx">Behave</span><span class="o">::</span><span class="na">track</span><span class="p">(</span><span class="s2">"42"</span><span class="p">,</span> <span class="s2">"login"</span><span class="p">);</span>
</pre></div>

<h3>
<a name="contextual-tracking" class="anchor" href="#contextual-tracking"><span class="octicon octicon-link"></span></a>Contextual tracking</h3>

<div class="highlight highlight-php"><pre><span class="nx">Behave</span><span class="o">::</span><span class="na">track</span><span class="p">(</span><span class="s2">"42"</span><span class="p">,</span> <span class="s2">"coment-tvshow"</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'tvShow'</span>  <span class="o">=&gt;</span> <span class="mi">24</span><span class="p">,</span>
  <span class="s1">'episode'</span> <span class="o">=&gt;</span> <span class="mi">11</span>
<span class="p">));</span>
</pre></div>

<h3>
<a name="tracking-results" class="anchor" href="#tracking-results"><span class="octicon octicon-link"></span></a>Tracking results</h3>

<p>When you track a user behaviours using <code>track()</code> you get back a result object you can use. The result contains the actions that the tracking has trigger (from your <a href="http://dashboard.behave.io/recipes">recipes</a>).</p>

<div class="highlight highlight-php"><pre><span class="nv">$bhResults</span> <span class="o">=</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">track</span><span class="p">(</span><span class="s2">"42"</span><span class="p">,</span> <span class="s2">"check-in"</span><span class="p">);</span>
</pre></div>

<p>The results contains 3 attributes.</p>

<table>
<thead><tr>
<th>Name</th>
<th align="center">Type</th>
<th align="right">Value</th>
</tr></thead>
<tbody>
<tr>
<td>badge</td>
<td align="center">Badge</td>
<td align="right">The unlocked badge (if any, null otherwise)</td>
</tr>
<tr>
<td>points</td>
<td align="center">Object</td>
<td align="right">The points earned for that action (if any, 0 otherwise)</td>
</tr>
<tr>
<td>leaderboards</td>
<td align="center">Array[LeaderboardResults]</td>
<td align="right">Leaderboard updates (if any,  empty otherwise)</td>
</tr>
</tbody>
</table><p>Example accessing <code>$bhResults-&gt;points</code> attribute.</p>

<div class="highlight highlight-php"><pre><span class="k">echo</span> <span class="nv">$bhResults</span><span class="o">-&gt;</span><span class="na">points</span>
<span class="p">{</span> 
  <span class="c1">// The number of points the user earned by taking the action</span>
  <span class="s1">'earned'</span>  <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> 

  <span class="c1">// The player's updated balance including the points he just earned</span>
  <span class="s1">'balance'</span> <span class="o">=&gt;</span> <span class="mi">840</span>
<span class="p">}</span>
</pre></div>

<p>If not null <code>$bhResults-&gt;badge</code> contains the Badge that the user has just unlocked. The structure looks like this:</p>

<div class="highlight highlight-php"><pre><span class="k">echo</span> <span class="nv">$bhResults</span><span class="o">-&gt;</span><span class="na">badge</span> 
<span class="c1">// Example output</span>
<span class="p">{</span>
    <span class="c1">// Reward id</span>
    <span class="s2">"_id"</span>    <span class="o">=&gt;</span> <span class="s2">"52a01b67cc7df72c79000003"</span>
    <span class="c1">// Number of times this reward was earned by this player</span>
    <span class="s2">"count"</span>  <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="c1">// Badge definition</span>
    <span class="s2">"badge"</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Badge id</span>
      <span class="s2">"_id"</span>          <span class="o">=&gt;</span> <span class="s2">"529fff2356ce248366000006"</span>
      <span class="c1">// badge name</span>
      <span class="s2">"name"</span>         <span class="o">=&gt;</span> <span class="s2">"Deloitte Newbie"</span>
      <span class="c1">// Badge custom id you have defnied</span>
      <span class="s2">"reference_id"</span> <span class="o">=&gt;</span> <span class="s2">"42-newbie"</span>
      <span class="c1">// If badge not active, it cannot be unlocked</span>
      <span class="s2">"active"</span>       <span class="o">=&gt;</span> <span class="k">true</span>
      <span class="c1">// If unique, a player can unlock this badge ONLY ONCE</span>
      <span class="s2">"unique"</span>       <span class="o">=&gt;</span> <span class="k">false</span>
      <span class="c1">// the badge can be unlocked in total, 0 means unlimited.</span>
      <span class="s2">"limit"</span>        <span class="o">=&gt;</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>

<p>If not empty, <code>$bhResults-&gt;leaderboards</code> will contain something like this</p>

<div class="highlight highlight-php"><pre><span class="k">echo</span> <span class="nv">$bhResults</span><span class="o">-&gt;</span><span class="na">leaderboards</span>
<span class="p">[</span>
  <span class="p">{</span>
     <span class="c1">// The updated leaderboard</span>
     <span class="s1">'leaderboard'</span>      <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'id'</span><span class="o">=&gt;</span> <span class="s1">'529fff1156ce248366000006'</span><span class="p">,</span>
        <span class="s1">'reference_id'</span> <span class="o">=&gt;</span> <span class="s1">'custom-id-you-have-defined'</span>
     <span class="p">},</span>
     <span class="c1">// Player's position before the update</span>
     <span class="s1">'prev_position'</span>    <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
     <span class="c1">// Player's position after the update</span>
     <span class="s1">'post_position     =&gt; 2,</span>
<span class="s1">     // Player'</span><span class="nx">s</span> <span class="nx">updated</span> <span class="nx">score</span>
     <span class="s1">'score'</span>            <span class="o">=&gt;</span> <span class="mi">435</span><span class="p">,</span>
     <span class="c1">// The players that have been defeated (3-&gt;5)</span>
     <span class="s1">'defeated_players'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'player-custom-id1'</span><span class="p">,</span> <span class="s1">'player-custom-id2'</span><span class="p">,</span> <span class="s1">'player-custom-id3'</span><span class="p">]</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>

<h2>
<a name="leaderboards" class="anchor" href="#leaderboards"><span class="octicon octicon-link"></span></a>Leaderboards</h2>

<h3>
<a name="getting-a-leaderboard-current-results" class="anchor" href="#getting-a-leaderboard-current-results"><span class="octicon octicon-link"></span></a>Getting a leaderboard current results</h3>

<p>You can fetch the actual results of any leaderboard at anytime. <strong>The result is an array sorted by score ascending</strong></p>

<div class="highlight highlight-php"><pre><span class="nv">$leaderboardResults</span> <span class="o">=</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">fetchLeaderboardResults</span><span class="p">(</span><span class="s1">'sample-leaderboard'</span><span class="p">);</span>
</pre></div>

<p>Results structure will look like this</p>

<div class="highlight highlight-php"><pre><span class="p">[</span>
  <span class="p">{</span>
    <span class="c1">// Player score</span>
    <span class="s1">'score'</span>  <span class="o">=&gt;</span> <span class="mi">129</span><span class="p">,</span>
    <span class="s1">'player'</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s1">'_id'</span> <span class="o">=&gt;</span> <span class="s2">"529fe03ecbd86b9d6c000002"</span><span class="p">,</span>
      <span class="s1">'traits'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'name'</span>  <span class="o">=&gt;</span> <span class="s1">'Olivier Thierry'</span>
        <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'olivier@behave.io'</span>
      <span class="p">},</span>
      <span class="s1">'identities'</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="s1">'facebook'</span> <span class="o">=&gt;</span> <span class="mi">12323</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="c1">// Player score</span>
    <span class="s1">'score'</span>  <span class="o">=&gt;</span> <span class="mi">102</span><span class="p">,</span>
    <span class="s1">'player'</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s1">'_id'</span> <span class="o">=&gt;</span> <span class="s2">"947pg03ecbd86b9d6c05520"</span><span class="p">,</span>
      <span class="s1">'traits'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'name'</span>  <span class="o">=&gt;</span> <span class="s1">'Olivier Jeandel'</span>
        <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'jide@behave.io'</span>
      <span class="p">},</span>
      <span class="s1">'identities'</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="s1">'facebook'</span> <span class="o">=&gt;</span> <span class="mi">5435</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>

<h3>
<a name="getting-a-leaderboard-previous-results" class="anchor" href="#getting-a-leaderboard-previous-results"><span class="octicon octicon-link"></span></a>Getting a leaderboard previous results</h3>

<p>For leaderboard with a timeframe other than "alltime" keep a copy of the previous leaderboard results, before it was reset to 0. (e.g A daily leaderboard will keep the results of the previous day).</p>

<div class="highlight highlight-php"><pre><span class="nv">$leaderboardResults</span> <span class="o">=</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">fetchLeaderboardPreviousResults</span><span class="p">(</span><span class="s1">'sample-leaderboard'</span><span class="p">);</span>
</pre></div>

<h3>
<a name="creating-a-new-leaderboard" class="anchor" href="#creating-a-new-leaderboard"><span class="octicon octicon-link"></span></a>Creating a new leaderboard</h3>

<div class="highlight highlight-php"><pre><span class="nv">$leaderboardResults</span> <span class="o">=</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">createLeaderboard</span><span class="p">(</span><span class="s1">'Influencers'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'reference_id'</span> <span class="o">=&gt;</span> <span class="s1">'some-custom-unique-id'</span><span class="p">,</span>
  <span class="s1">'type'</span>         <span class="o">=&gt;</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">LEADERBOARD_TYPE_SCORE</span><span class="p">,</span>
  <span class="s1">'scoreType'</span>    <span class="o">=&gt;</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">LEADERBOARD_SCORE_SUM</span><span class="p">,</span>
  <span class="s1">'timeFrame'</span>    <span class="o">=&gt;</span> <span class="nx">LEADERBOARD_TIME_WEEKLY</span><span class="p">,</span>
  <span class="s1">'active'</span>       <span class="o">=&gt;</span> <span class="k">true</span> <span class="c1">// Defaults</span>
<span class="p">));</span>
</pre></div>

<p>You can also bind rewards to a leaderboard (So it becomes a contest).
Rewards are Badges. Each reward defines the position in the leaderboard to who this rewards should be given and the Badge that it refers to.</p>

<p>You can define contest leaderboard this way.</p>

<div class="highlight highlight-php"><pre><span class="nv">$leaderboardResults</span> <span class="o">=</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">createLeaderboard</span><span class="p">(</span><span class="s1">'Influencers'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
  <span class="s1">'reference_id'</span> <span class="o">=&gt;</span> <span class="s1">'some-custom-unique-id'</span><span class="p">,</span>
  <span class="s1">'type'</span>         <span class="o">=&gt;</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">LEADERBOARD_TYPE_SCORE</span><span class="p">,</span>
  <span class="s1">'scoreType'</span>    <span class="o">=&gt;</span> <span class="nx">Behave</span><span class="o">::</span><span class="na">LEADERBOARD_SCORE_SUM</span><span class="p">,</span>
  <span class="s1">'timeFrame'</span>    <span class="o">=&gt;</span> <span class="nx">LEADERBOARD_TIME_WEEKLY</span><span class="p">,</span>
  <span class="s1">'active'</span>       <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="c1">// Defaults</span>
  <span class="s1">'rewards'</span>      <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">'position'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'badge'</span> <span class="o">=&gt;</span> <span class="s1">'some-custom-id-or-original-id'</span><span class="p">)</span>
  <span class="p">),</span>
<span class="p">));</span>
</pre></div>

<h3>
<a name="deleting-a-leaderboard" class="anchor" href="#deleting-a-leaderboard"><span class="octicon octicon-link"></span></a>Deleting a leaderboard</h3>

<div class="highlight highlight-php"><pre><span class="nx">Behave</span><span class="o">::</span><span class="na">deleteLeaderboard</span><span class="p">(</span><span class="s1">'some-custom-id-or-original-id'</span><span class="p">);</span>
</pre></div>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
